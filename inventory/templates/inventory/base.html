{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HFPS TIC | {% block title %}Dashboard{% endblock %}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
</head>

<body>

    <nav class="sidebar">
        <div style="text-align: center; margin-bottom: 2rem;">
            {% if system_settings and system_settings.logo %}
            <img src="{{ system_settings.logo.url }}" alt="{{ system_settings.site_name|default:'HFPS Logo' }}"
                style="max-width: 80%; height: auto; border-radius: 8px;">
            {% else %}
            <img src="{% static 'img/hfps.jpg' %}?v=3" alt="HFPS Logo"
                style="max-width: 80%; height: auto; border-radius: 8px;">
            {% endif %}
        </div>
        <div class="nav-links">
            <a href="{% url 'inventory:dashboard' %}"
                class="{% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                ğŸ“Š Dashboard
            </a>
            <a href="{% url 'inventory:equipment_list' %}"
                class="{% if request.resolver_match.url_name == 'equipment_list' %}active{% endif %}">
                ğŸ“¦ Inventario
            </a>
            <a href="{% url 'inventory:maintenance_list' %}"
                class="{% if request.resolver_match.url_name == 'maintenance_list' or request.resolver_match.url_name == 'maintenance_create' %}active{% endif %}">
                ğŸ› ï¸ Mantenimiento
            </a>
            <a href="{% url 'inventory:handover_list' %}"
                class="{% if request.resolver_match.url_name == 'handover_list' or request.resolver_match.url_name == 'handover_create' %}active{% endif %}">
                ğŸ“ Entregas
            </a>
            <a href="{% url 'inventory:maintenance_schedule' %}"
                class="{% if request.resolver_match.url_name == 'maintenance_schedule' %}active{% endif %}">
                ğŸ“… Cronograma
            </a>
            <a href="{% url 'inventory:equipment_round_list' %}"
                class="{% if request.resolver_match.url_name == 'equipment_round_list' or request.resolver_match.url_name == 'equipment_round_create' %}active{% endif %}">
                ğŸ”„ Rondas
            </a>
            <a href="{% url 'inventory:reports_dashboard' %}"
                class="{% if request.resolver_match.url_name == 'reports_dashboard' %}active{% endif %}">
                ğŸ“Š Reportes
            </a>
            <a href="{% url 'inventory:peripheral_list' %}"
                class="{% if request.resolver_match.url_name == 'peripheral_list' or request.resolver_match.url_name == 'peripheral_detail' %}active{% endif %}">
                ğŸ–±ï¸ PerifÃ©ricos
            </a>
            <a href="{% url 'inventory:area_list' %}"
                class="{% if request.resolver_match.url_name == 'area_list' or request.resolver_match.url_name == 'area_edit' %}active{% endif %}">
                ğŸ¢ Ãreas
            </a>
            <a href="{% url 'inventory:cost_center_list' %}"
                class="{% if request.resolver_match.url_name == 'cost_center_list' or request.resolver_match.url_name == 'cost_center_edit' %}active{% endif %}">
                ğŸ’° Centros de Costos
            </a>
            {% if user.is_staff or user.is_superuser %}
            <a href="{% url 'users:user_list' %}" class="{% if 'users/manage' in request.path %}active{% endif %}">
                ğŸ‘¥ Usuarios
            </a>
            {% endif %}

        </div>
    </nav>

    <main class="main-content">
        <header class="header">
            <h1>{% block page_title %}Dashboard{% endblock %}</h1>
            <div>
                {% if user.is_authenticated %}
                <div class="user-menu" style="position: relative; display: inline-block;">
                    <button onclick="toggleUserMenu()" class="btn-user-menu"
                        style="background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; font-size: 1rem; color: #374151; padding: 0.5rem;">
                        <span
                            style="background: #e5e7eb; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #4b5563;">
                            {{ user.username|first|upper }}
                        </span>
                        <span>{{ user.username }}</span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z" />
                        </svg>
                    </button>
                    <!-- Dropdown Content -->
                    <div id="userDropdown"
                        style="display: none; position: absolute; right: 0; top: 100%; background: white; border: 1px solid #e5e7eb; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 220px; z-index: 50; overflow: hidden; margin-top: 0.5rem;">
                        <div style="padding: 1rem; border-bottom: 1px solid #f3f4f6;">
                            <p style="margin: 0; font-weight: 600; color: #111827;">{{ user.first_name }} {{
                                user.last_name }}</p>
                            <p style="margin: 0; font-size: 0.85rem; color: #6b7280;">{{ user.email }}</p>
                        </div>

                        <!-- Profile Link -->
                        <a href="{% url 'users:profile' %}"
                            style="width: 100%; text-align: left; background: none; border: none; padding: 0.75rem 1rem; cursor: pointer; color: #374151; font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem; text-decoration: none;">
                            ğŸ‘¤ Mi Perfil
                        </a>

                        <!-- Actions -->
                        <!-- Switch User (Logout then redirect to login) -->
                        <form action="{% url 'logout' %}" method="post"
                            style="margin: 0; border-top: 1px solid #f3f4f6;">
                            {% csrf_token %}
                            <input type="hidden" name="next" value="{% url 'login' %}">
                            <button type="submit"
                                style="width: 100%; text-align: left; background: none; border: none; padding: 0.75rem 1rem; cursor: pointer; color: #374151; font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;">
                                ğŸ”„ Cambiar de Usuario
                            </button>
                        </form>

                        <!-- Logout -->
                        <form action="{% url 'logout' %}" method="post"
                            style="margin: 0; border-top: 1px solid #f3f4f6;">
                            {% csrf_token %}
                            <button type="submit"
                                style="width: 100%; text-align: left; background: none; border: none; padding: 0.75rem 1rem; cursor: pointer; color: #ef4444; font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;">
                                ğŸšª Cerrar SesiÃ³n
                            </button>
                        </form>
                    </div>
                </div>
                {% else %}
                <a href="{% url 'login' %}" class="btn btn-primary">Login</a>
                {% endif %}
            </div>
        </header>

        {% block content %}
        {% endblock %}

        <footer class="app-footer">
            <div>
                &copy; {{ now|date:"Y" }} Desarrollado por <strong>Ever Duvan</strong>. <br> Todos los derechos
                reservados.
                <span style="margin-left: 0.5rem; opacity: 0.7;">v1.2.0</span>
            </div>
            <div class="footer-links">
                <a href="{% url 'inventory:support_help_desk' %}">Soporte Help Desk</a>
                <a href="{% url 'inventory:user_manual' %}">Manual de Usuario</a>
                <a href="{% url 'inventory:privacy_policy' %}">PolÃ­ticas de Privacidad</a>
            </div>
        </footer>
    </main>

    <script src="{% static 'js/main.js' %}"></script>
    <script>
        function toggleUserMenu() {
            const menu = document.getElementById('userDropdown');
            if (menu.style.display === 'none' || menu.style.display === '') {
                menu.style.display = 'block';
            } else {
                menu.style.display = 'none';
            }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function (event) {
            const menu = document.getElementById('userDropdown');
            const btn = document.querySelector('.btn-user-menu');

            if (menu && btn && !menu.contains(event.target) && !btn.contains(event.target)) {
                menu.style.display = 'none';
            }
        });
    </script>
</body>

</html>