import csv
import io
import random
from django.core.management.base import BaseCommand
from inventory.models import Equipment, Area

class Command(BaseCommand):
    help = 'Import equipments from CSV data provided in code'

    def handle(self, *args, **options):
        csv_data = """serial_number,type,brand,model,area,status,processor,ram,storage,os,voltage,amperage,os_user,screen_size
MXL65121J9,,,,ADMINISTRACION DEL TALENTO HUMANO,ACTIVE,,,,Windows 10,110V,,,
HFPS5370,,,,ADMINISTRACION DEL TALENTO HUMANO,ACTIVE,,,,Windows 11,110V,,,
MXL22307KV,,,,ADMINISTRACION DEL TALENTO HUMANO,ACTIVE,,,,,110V,,,
MXL4151HCD,,,,ADMINISTRACION DEL TALENTO HUMANO,ACTIVE,,,,Windows 10,110V,,,
MXL7050GCG,,,,ADMINISTRACION DEL TALENTO HUMANO,ACTIVE,,,,,110V,,,
MXL7050GCW,,,,ADMINISTRACION DEL TALENTO HUMANO,ACTIVE,,,,,110V,,,
MXL0090S8C,,,,ADMINISTRACION DOCUMENTAL,ACTIVE,,,,,110V,,,
MXL22303YY,,,,ADMINISTRACION DOCUMENTAL,ACTIVE,,,,,110V,,,
MXL2230432,,,,ADMINISTRACION DOCUMENTAL,ACTIVE,,,,,110V,,,
MXL2230434,,,,ADMINISTRACION DOCUMENTAL,ACTIVE,,,,,110V,,,
MP2A83FD,,,,ALMACEN Y ACTIVOS FIJOS,ACTIVE,,,,,110V,,,
MXL223042X,,,,ALMACEN Y ACTIVOS FIJOS,ACTIVE,,,,,110V,,,
MXL42819JQ,,,,ALMACEN Y ACTIVOS FIJOS,ACTIVE,,,,,110V,,,
MXL223042P,,,,ATENCION AL PACIENTE CONSUMIDOR SPA,ACTIVE,,,,,110V,,,
MXL223043Y,,,,ATENCION AL PACIENTE CONSUMIDOR SPA,ACTIVE,,,,,110V,,,
MXL22307LS,,,,ATENCION AL PACIENTE CONSUMIDOR SPA,ACTIVE,,,,,110V,,,
MXL22303YX,,,,AUDITORIA MEDICA,ACTIVE,,,,,110V,,,
MXL22303YZ,,,,AUDITORIA MEDICA,ACTIVE,,,,,110V,,,
5CD735781L,,,,AUDITORIA MEDICA,ACTIVE,,,,,110V,,,
MXL42819JR,,,,CARTERA,ACTIVE,,,,,110V,,,
MXL7081JRK,,,,CARTERA,ACTIVE,,,,,110V,,,
MXL22303YH,,,,CENTRO DE ATENCION AL CIUDADANO,ACTIVE,,,,,110V,,,
MXL22303YJ,,,,CENTRO DE ATENCION AL CIUDADANO,ACTIVE,,,,,110V,,,
MXL4151HBQ,,,,CENTRO DE ATENCION AL CIUDADANO,ACTIVE,,,,,110V,,,
MXL5191ZJ0,,,,CENTRO DE ATENCION AL CIUDADANO,ACTIVE,,,,,110V,,,
MXL80611CS,,,,CONSULTA EXTERNA ESPECIALIZADA,ACTIVE,,,,,110V,,,
MXL223043B,,,,CONSULTA EXTERNA ESPECIALIZADA,ACTIVE,,,,,110V,,,
MXL223043W,,,,CONSULTA EXTERNA ESPECIALIZADA,ACTIVE,,,,,110V,,,
MXL22307LD,,,,CONSULTA EXTERNA ESPECIALIZADA,ACTIVE,,,,,110V,,,
MXL4151HBW,,,,CONSULTA EXTERNA ESPECIALIZADA,ACTIVE,,,,,110V,,,
MXL4151HC2,,,,CONSULTA EXTERNA ESPECIALIZADA,ACTIVE,,,,,110V,,,
MXL42819J8,,,,CONSULTA EXTERNA ESPECIALIZADA,ACTIVE,,,,,110V,,,
MXL7050GCT,,,,CONTABILIDAD,ACTIVE,,,,,110V,,,
CND4269KVM,,,,CONTABILIDAD,ACTIVE,,,,,110V,,,
MXL2230430,,,,"CONTRATACION, COMPRAS Y SUMINISTROS",ACTIVE,,,,,110V,,,
MXL22303XX,,,,CONTROL INTERNO,ACTIVE,,,,,110V,,,
MXL7050G8L,,,,COSTOS,ACTIVE,,,,,110V,,,
HFPS3989,,,,DIRECCION TI,ACTIVE,,,,,110V,,,
MXL5191ZH9,,,,DIRECCION TI,ACTIVE,,,,,110V,,,
MXL7050G8G,,,,DIRECCION TI,ACTIVE,,,,,110V,,,
MXL7050GCM,,,,DIRECCION TI,ACTIVE,,,,,110V,,,
MXL7050GCV,,,,DIRECCION TI,ACTIVE,,,,,110V,,,
MXL7050GD2,,,,DIRECCION TI,ACTIVE,,,,,110V,,,
QAAUD014H25E65,,,,DIRECCION TI,ACTIVE,,,,,110V,,,
5CD7050RTF,,,,DIRECCION TI,ACTIVE,,,,,110V,,,
89642391Q,,,,DIRECCION TI,ACTIVE,,,,,110V,,,
CND8044MR3,,,,DIRECCION TI,ACTIVE,,,,,110V,,,
MXL22303YB,,,,FACTURACION,ACTIVE,,,,,110V,,,
MXL223043F,,,,FACTURACION,ACTIVE,,,,,110V,,,
MXL22307L9,,,,FACTURACION,ACTIVE,,,,,110V,,,
MXL4151HBZ,,,,FACTURACION,ACTIVE,,,,,110V,,,
MXL4151HC6,,,,FACTURACION,ACTIVE,,,,,110V,,,
MXL7050GCP,,,,FACTURACION,ACTIVE,,,,,110V,,,
MXL7050GD1,,,,FACTURACION,ACTIVE,,,,,110V,,,
MP2B4V6A,,,,FONOAUDIOLOGIA,ACTIVE,,,,,110V,,,
5CD649469S,,,,GERENCIA,ACTIVE,,,,,110V,,,
5CG10628VV,,,,GERENCIA,ACTIVE,,,,,110V,,,
MXL223042T,,,,GESTION AMBIENTAL,ACTIVE,,,,,110V,,,
MXL74129Z0,,,,GLOSAS,ACTIVE,,,,,110V,,,
MXL7050GCS,,,,GLOSAS,ACTIVE,,,,,110V,,,
MXL7050GCZ,,,,GLOSAS,ACTIVE,,,,,110V,,,
MXL7050GDX,,,,GLOSAS,ACTIVE,,,,,110V,,,
MXL65121JG,,,,HOSPITALIZACION SALA GENERAL,ACTIVE,,,,,110V,,,
MXL22303YQ,,,,HOSPITALIZACION SALA GENERAL,ACTIVE,,,,,110V,,,
MXL5191ZHH,,,,HOSPITALIZACION SALA GENERAL,ACTIVE,,,,,110V,,,
MXL2230440,,,,HOSPITALIZACION SALA GENERAL PISO 1,ACTIVE,,,,,110V,,,
MXL22303XZ,,,,JURIDICO,ACTIVE,,,,,110V,,,
MXL22303YK,,,,JURIDICO,ACTIVE,,,,,110V,,,
MXL223043Q,,,,JURIDICO,ACTIVE,,,,,110V,,,
MXL22307L5,,,,JURIDICO,ACTIVE,,,,,110V,,,
CND8044MSP,,,,JURIDICO,ACTIVE,,,,,110V,,,
MXL22303Z0,,,,LABORATORIO CLINICO,ACTIVE,,,,,110V,,,
MXL22303Z9,,,,LABORATORIO CLINICO,ACTIVE,,,,,110V,,,
MXL22307KX,,,,MANTENIMIENTO,ACTIVE,,,,,110V,,,
MXL4151HBJ,,,,MANTENIMIENTO,ACTIVE,,,,,110V,,,
5CD7050RV0,,,,MERCADEO Y COMUNICACIONES,ACTIVE,,,,,110V,,,
MXL7050GCJ,,,,"PLANEACION, GESTION Y PROYECTOS",ACTIVE,,,,,110V,,,
MXL7050GF0,,,,"PLANEACION, GESTION Y PROYECTOS",ACTIVE,,,,,110V,,,
8CG85032V2,,,,"PLANEACION, GESTION Y PROYECTOS",ACTIVE,,,,,110V,,,
MXL22303YS,,,,PRESUPUESTO,ACTIVE,,,,,110V,,,
MXL7081JRM,,,,PRESUPUESTO,ACTIVE,,,,,110V,,,
MP2B4V5A,,,,PSICOLOGIA,ACTIVE,,,,,110V,,,
MXL3321JR0,,,,QUIROFANOS,ACTIVE,,,,,110V,,,
MXL80611D0,,,,QUIROFANOS,ACTIVE,,,,,110V,,,
MXL80611D1,,,,QUIROFANOS,ACTIVE,,,,,110V,,,
MXL80611DV,,,,QUIROFANOS,ACTIVE,,,,,110V,,,
MXL8091F20,,,,QUIROFANOS,ACTIVE,,,,,110V,,,
MXL8101H10,,,,QUIROFANOS,ACTIVE,,,,,110V,,,
MXL22303Y0,,,,QUIROFANOS,ACTIVE,,,,,110V,,,
MXL22303YV,,,,QUIROFANOS,ACTIVE,,,,,110V,,,
MXL22303Z4,,,,QUIROFANOS,ACTIVE,,,,,110V,,,
MXL42819GM,,,,QUIROFANOS,ACTIVE,,,,,110V,,,
5CD8278XD6,,,,QUIROFANOS,ACTIVE,,,,,110V,,,
5CD8278XK3,,,,QUIROFANOS,ACTIVE,,,,,110V,,,
5CD82797HZ,,,,QUIROFANOS,ACTIVE,,,,,110V,,,
MXL4151HC3,,,,REFERENCIA Y CONTRAREFERENCIA,ACTIVE,,,,,110V,,,
MXL7050GCQ,,,,REFERENCIA Y CONTRAREFERENCIA,ACTIVE,,,,,110V,,,
2CE3190JTG,,,,REFERENCIA Y CONTRAREFERENCIA,ACTIVE,,,,,110V,,,
MXL7050MBC,,,,SALA DE GINECOBSTETRICIA,ACTIVE,,,,,110V,,,
MXL8101H0T,,,,SALA DE GINECOBSTETRICIA,ACTIVE,,,,,110V,,,
MXL22307LF,,,,SALA DE GINECOBSTETRICIA,ACTIVE,,,,,110V,,,
MXL22307LV,,,,SALA DE GINECOBSTETRICIA,ACTIVE,,,,,110V,,,
MXL223042Q,,,,SEGURIDAD DEL PACIENTE,ACTIVE,,,,,110V,,,
MXL223042W,,,,SEGURIDAD DEL PACIENTE,ACTIVE,,,,,110V,,,
MXl2310WMJ,,,,SERVICIO FARMACEUTICO,ACTIVE,,,,,110V,,,
MXL22303YL,,,,SERVICIO FARMACEUTICO,ACTIVE,,,,,110V,,,
MXL223042Z,,,,SERVICIO FARMACEUTICO,ACTIVE,,,,,110V,,,
MXL223043K,,,,SERVICIO FARMACEUTICO,ACTIVE,,,,,110V,,,
MXL223043X,,,,SERVICIO FARMACEUTICO,ACTIVE,,,,,110V,,,
MXL2230444,,,,SERVICIO FARMACEUTICO,ACTIVE,,,,,110V,,,
MXL4151HBL,,,,SERVICIO FARMACEUTICO,ACTIVE,,,,,110V,,,
CND0490JR7,,,,SISTEMA OBLIGATORIO DE CALIDAD,ACTIVE,,,,,110V,,,
MXL7050GCN,,,,SUBGERENCIA CIENTIFICA,ACTIVE,,,,,110V,,,
MP2B4V6J,,,,TERAPIA FISICA,ACTIVE,,,,,110V,,,
H2N0CV13C596086,,,,TERAPIA RESPIRATORIA,ACTIVE,,,,,110V,,,
MXL223043D,,,,TERAPIA RESPIRATORIA,ACTIVE,,,,,110V,,,
MXL7050G8R,,,,TESORERIA,ACTIVE,,,,,110V,,,
MXL7050GCR,,,,TESORERIA,ACTIVE,,,,,110V,,,
MXL7050G84,,,,UNIDAD DE ANALISIS,ACTIVE,,,,,110V,,,
MXL2512BJ7,,,,URGENCIAS CONSULTAS Y PROCEDIMIENTOS,ACTIVE,,,,,110V,,,
MXL22303Y1,,,,URGENCIAS CONSULTAS Y PROCEDIMIENTOS,ACTIVE,,,,,110V,,,
MXL223042Y,,,,URGENCIAS CONSULTAS Y PROCEDIMIENTOS,ACTIVE,,,,,110V,,,
MXL22307LW,,,,URGENCIAS CONSULTAS Y PROCEDIMIENTOS,ACTIVE,,,,,110V,,,
MXL4151HBS,,,,URGENCIAS CONSULTAS Y PROCEDIMIENTOS,ACTIVE,,,,,110V,,,
MXL42819J9,,,,URGENCIAS CONSULTAS Y PROCEDIMIENTOS,ACTIVE,,,,,110V,,,
5CG8155PP3,,,,URGENCIAS CONSULTAS Y PROCEDIMIENTOS,ACTIVE,,,,,110V,,,
MXL22303XW,,,,VIGILANCIA EPIDEMIOLOGICA,ACTIVE,,,,,110V,,,
MXL2230YT,,,,VIGILANCIA EPIDEMIOLOGICA,ACTIVE,,,,,110V,,,
MXL42819J,,,,VIGILANCIA EPIDEMIOLOGICA,ACTIVE,,,,,110V,,,
"""
        reader = csv.DictReader(io.StringIO(csv_data))
        
        count = 0
        for row in reader:
            serial = row['serial_number'].strip()
            if not serial:
                continue
                
            # Get or create Area
            area_name = row['area'].strip()
            area = None
            if area_name:
                area, _ = Area.objects.get_or_create(name=area_name)
            
            # Defaults for missing data
            brand = row['brand'].strip() or 'HP'
            model = row['model'].strip() or 'ProDesk 600'
            eq_type = row['type'].strip() or 'PC'
            status = row['status'].strip() or 'ACTIVE'
            
            # Check existing
            if Equipment.objects.filter(serial_number=serial).exists():
                self.stdout.write(self.style.WARNING(f'Skipping existing: {serial}'))
                continue
            
            Equipment.objects.create(
                serial_number=serial,
                type=eq_type,
                brand=brand,
                model=model,
                area=area,
                status=status,
                processor=row['processor'].strip() or 'Intel Core i5',
                ram=row['ram'].strip() or '8GB',
                storage=row['storage'].strip() or '256GB SSD',
                operating_system=row['os'].strip() or 'Windows 10 Pro',
                voltage=row['voltage'].strip(),
                amperage=row['amperage'].strip(),
                os_user=row['os_user'].strip(),
                screen_size=row['screen_size'].strip() or '21"',
            )
            count += 1
            
        self.stdout.write(self.style.SUCCESS(f'Successfully imported {count} equipments'))
